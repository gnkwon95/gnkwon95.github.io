## 로그기록이란?

고객 정보를 파악하고 매출을 높이기 위해 가장 중요한것은 로그 기록이라고 생각된다.
유저가 남기는 발자취등을 모두 기록하고, 관리하는 테이블로 react에서 특정 버튼을 누르면 그에 대한 정보를 남기는 것이 가장 이상적이다. 
모든 로그를 남기는 시간적 비용이 0이고, 모든 데이터를 마음편히 남기며 저장에 대한 비용마저 0이라면 많은 분석이 가능하다.
하지만 어떤 로그를 남길지, 어떠한 형태로 어떠한 관계로 남길지 등에 대한 고민도 필요하고
무엇보다 관계도의 설계가 매우 복잡하기에 계획된 설계가 필요하다.

### 현황.

지금 컨택 프로젝트는 로그를 남기기 위한 많은 방식을 도입하기보다, drf-api-tracking 라이브러리를 사용한다.
axios로 특정 view에 접근하면 이에 대한 기록을 별도로 대신 남겨준다. 
해당 코드의 장점은 
1. 편리하다. 따로 신경쓰지 않고, 기존 코드에 라이브러리를 얹는것만으로 모든 axios 관련 명령들이 기록된다
2. 빠르다. 별도 post 명령어를 사용하지 않아도 로그가 부가 비용 없이 쌓이고, 비용이 생기더라도 백에서 프론트와 비동기 실행이 된다. 프론트를 쓰는 유저가 편하다
3. 쉽다. 다양한 기능들 (어느 경우에는 기록, 어느경우에는 무시)을 적용하면 복잡한 과정으로 조건을 넣어 데이터를 남기는게 가능하다. 데이터가 매우 많아질 때 편리하다.
4. 실제 문제점 찾기에 편하다. 원래 '로그 데이터'라는 개념은 버그를 찾기 위해, 혹은 특정 행위에서 문제가 발견될 시 이를 캐치하기 위한 작업이었다. 이 부분은 매우 적합하다.

하지만 이에 따르는 단점도 있다.
1. 제한적이다. axios관련 명령에만 라이브러리가 남기 때문에 프론트 내에서의 처리들 (결제창 어디까지 간 경우, modal 누른 경우 등)은 기록되지 않는다.
이 문제는 임의로 axios.get을 더미값을 부르며 처리할 수 있긴 하지만 데이터 분석이 매우 어려워지고, 1차 가공이 필요해진다
2. 유연하지 못하다. column값들이 기본적으로 정해져있다. 대부분 실제 필요한 정보들이지만, 이 값들을 input 단계에서 수정하기 어렵다.
또한 입력 위치마다 다른 명령어를 쓰기 어렵고, 어떤 페이지에서 사용되었는지 알기 위해 axios 인풋값들을 모두 이해해야 한다 ('/connection/?user=abc'가 기록에 남고, 이를 이해해야함)
3. 2의 연장선이자 이 고민을 한 본질적인 문제로, 프론트와 동떨어져있다. 
어느 ip에서 백을 요청했는지 알 수 있지만, 요청한 프론트의 유저가 누구인지 기본적으로 알 수 없다.
물론, 장고가 유저 로그인을 직접 관리하고 있다면 유저 정보도 백에서 알 수 있다.
하지만 파베가 이를 관리하는 현재 컨택 프로젝트에서 유저 정보를 인풋으로 받아와서 로그를 남길 수 없다.

요약하자면, 지금 방식으로는 유저 정보를 남길 수 없다. ip로 대충 추적할 뿐이다.
또한 어떤 요청을 했는지 찾기가 너무 어렵다. 마케터들이 고생한다.

### 해결책

지금 떠오르는 가장 쉬운 방법은 로그 자체를 push해서, 새로운 db를 만드는 것이다.
칼럼으로는 'user_id', 'user_uid', 'purpose', 'detail' 정도만 입력하고, logger_mixin을 사용해서 ip 등 상세정보를 가져오면 될 것 같다.

이 때 장점은 아래와 같다
1. 커스터마이징이 쉽다. 특정 페이지별로 세부 내용을 다르게 적을 수 있고, 마케터가 이해하기 쉽다. 
2. 데이터 크기를 적게 사용할 수 있다. logger mixin도 사용 안하면 필요 데이터 양이 많이 줄어든다. 다만 ip를 가져올 수는 없다

단점은 아래와 같다
1. 한 프론트 페이지 내에서 get을 하고 post도 해야하는데, 코드 작성도 어렵고 무엇보다 매번 post를 하는게 비용이 얼마나 걸릴지 모른다.
이 비용 계산 자체에 또 많은 시간이 소요된다
2. 구조를 만들기가 까다롭다.
당연히 user_id, user_uid, purpose, detail만으로 모든 페이지에서의 콜을 소화하기는 어려울 것이다. 
직접 작성하며 느끼겠지만 페이지별로 다른 로그가 필요할 수 있다. 아니면 detail이 많이 질이 떨어지게 된다.
이를 매우 잘 해결하고 서비스를 잘 이해해야하는것이 내 역할이겠지만, 자신할 수는 없다. AS가 매우 복잡해질 것이다.

하지만 당장 매우 빠른, 0.01초 단위의 래깅이 유저에 미치는 영향보다 빠른 트래킹이 우선이니 관련 해결책을 사용하도록 하겠다.
